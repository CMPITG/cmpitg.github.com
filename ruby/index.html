<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hướng dẫn Ruby</title>
    <meta name="author" content="Ha-Duong Nguyen" />
    <meta name="description" content="thoughts & rants on tech & language, by cmpitg" />
    <link rel="canonical" href="http://reference-error.org//ruby/" />
    <!-- <link href="//fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round" rel="stylesheet" type="text/css"> -->
    <link href="//fonts.googleapis.com/css?family=Alegreya+Sans|Ubuntu+Mono" rel="stylesheet">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="alternate" type="application/rss+xml" title="Reference Error" href="/atom.xml" />
    <link rel="stylesheet" href="/css/site.css">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
        ga('create', ', 'auto');
        ga('send', 'pageview');
    </script>
  </head>
  <body>
    <section>
      <header class="navigation">
        <div id="header-title">
          <a href="/" class="logo" title="Reference Error">
            Reference Error
      </a>
        </div>
        <div id="social-links-header">
          <a title="cmpitg @ github" href="https://github.com/cmpitg"><i class="fa fa-github-square"></i></a>
          <a title="cmpitg @ linkedin" href="https://fi.linkedin.com/in/cmpitg"><i class="fa fa-linkedin-square"></i></a>
          <a title="cmpitg @ twitter" href="https://twitter.com/cmpitg"><i class="fa fa-twitter-square"></i></a>
        </div>
        <nav>
          <ul>
            <li><a href="/logs">logs</a></li>
            <li><a href="/writing">writing</a></li>
            <li><a href="/talks">talks</a></li>
            <li><a href="/about">about</a></li>
            <li class="no-bullet"><a href="/atom.xml">rss</a></li>
          </ul>
        </nav>
      </header>
      <article>
        <h1 class="title">
          Hướng dẫn Ruby
  </h1>
        <p class="subtitle">
          <span>
            Series:
          
            
              <a href="/#ruby">ruby</a>,
            
          
            
              <a href="/#guide">guide</a>
          </span>
          <span class="date">
          </span>
        </p>
        <div id="post">
          <p><strong>Phiên bản hỗ trợ:</strong> <a href="http://www.ruby-lang.org/en/">Ruby 1.9+</a></p>
          <h2 id="cc-khi-nim">Các khái niệm</h2>
          <ul>
            <li><a href="http://en.wikipedia.org/wiki/Ruby_programming_language">Ruby</a> là một ngôn
ngữ lập trình
              <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">hướng đối tượng</a>
              <em>hoàn chỉnh</em>, ra đời vào năm 1995, thiết kế và implement bởi
              <a href="http://en.wikipedia.org/wiki/Yukihiro_Matsumoto">松本行弘</a> (Matsumoto
Yukihiro - hay <em>Matz</em>).</li>
          </ul>
          <h2 id="lu-">Lưu ý</h2>
          <ul>
            <li>
              <p>Khác với
                <a href="http://en.wikipedia.org/wiki/Java_%28programming_language%29">Java</a> đi bốc
phét “Everything is an object” (mà thực tế thì chẳng phải vậy).  Ruby là
ngôn ngữ hướng đối tượng “<em>hoàn chỉnh</em>”.  Trong Java bạn không thể (và chắc
là sẽ không bao giờ có cách) để làm được trò: <code class="highlighter-rouge">123.toString()</code>, mà trong
Ruby và
                <a href="http://en.wikipedia.org/wiki/Smalltalk_programming_language">Smalltalk</a> thì
cú pháp tương ứng là <code class="highlighter-rouge">123.to_s</code> và <code class="highlighter-rouge">123 printString</code>.  Bạn có thể tranh cãi
rằng <code class="highlighter-rouge">123</code> là một giá trị <code class="highlighter-rouge">primitive type</code> nên không gọi được method.  Đúng,
nhưng <code class="highlighter-rouge">primitive type</code> của Java không phải là class, và giá trị <code class="highlighter-rouge">123</code> không
phải là object; vì vậy khẩu hiệu “Everything is an object” của Java là <strong>bốc
phét</strong>!</p>
            </li>
            <li>
              <p>Ruby là một trong số 3 ngôn ngữ tôi đề xuất bạn tìm hiểu, nếu bạn <em>thực sự
nghiêm túc</em> muốn học &amp; sử dụng <em>lập trình hướng đối tượng</em> (OOP).  Hai ngôn
ngữ còn lại là
                <a href="http://en.wikipedia.org/wiki/Smalltalk_programming_language">Smalltalk</a> và
                <a href="http://en.wikipedia.org/wiki/Common_Lisp">Common Lisp</a>.</p>
            </li>
            <li>
              <p>Rất nhiều người nói Ruby giống và chịu ảnh hưởng của
                <a href="http://en.wikipedia.org/wiki/Perl">Perl</a>.  Điều này là hoàn toàn chuẩn xác!
Tuy nhiên nếu là tôi thì tôi sẽ bổ sung thêm: <em>Ruby là ngôn ngữ chịu ảnh
hưởng tốt từ Smalltalk (cú pháp) và Perl (cách tư duy).</em></p>
            </li>
          </ul>
          <h2 id="mi-trng">Môi trường</h2>
          <ul>
            <li>Bạn có thể sử dụng bất kỳ môi trường lập trình nào để chơi với Ruby.
              <a href="https://netbeans.org/">Netbeans</a>,
              <a href="http://en.wikipedia.org/wiki/Netbeans">Eclipse</a>,
              <a href="http://en.wikipedia.org/wiki/Scite">SCITE</a>,
              <a href="http://en.wikipedia.org/wiki/Notepad%2B%2B">Notepad++</a>,
              <a href="http://en.wikipedia.org/wiki/Geany">Geany</a>,
              <a href="http://en.wikipedia.org/wiki/Gedit">Gedit</a>,
              <a href="http://en.wikipedia.org/wiki/Vim_%28text_editor%29">Vim</a>, …  Tôi thì
chuộng Vim và <a href="http://en.wikipedia.org/wiki/Emacs#GNU_Emacs">GNU Emacs</a>.
Đến thời điểm viết guide này, tôi sử dụng Emacs cho Ruby hàng ngày.</li>
          </ul>
          <h2 id="im-khng-hay">Điểm không hay</h2>
          <ul>
            <li>Method của Ruby
              <a href="http://stackoverflow.com/questions/2602340/methods-in-ruby-objects-or-not">không phải là object</a>.
Method có thể được lưu và xử lý giống object bằng cách tạo wrapper, tuy
nhiên:
    
              <ul>
                <li>wrapper này không phải là object,</li>
                <li>wrapper được tạo mỗi lần method <code class="highlighter-rouge">method(:symbol)</code> được gọi, không tốt cho
performance,</li>
                <li>không có cách nào đồng nhất wrapper với method, method được gọi trực tiếp,
còn method bọc trong wrapper phải gọi bằng <code class="highlighter-rouge">.call</code> method:</li>
              </ul>
              <div class="language-ruby highlighter-rouge">
                <pre class="highlight"><code><span class="k">def</span> <span class="nf">a_method_look_like_function</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Hello </span><span class="si">#{</span><span class="n">arg</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>

<span class="c1"># Calling directly</span>
<span class="n">a_method_look_like_function</span> <span class="s1">'world!'</span>                <span class="c1"># =&gt; "Hello world!"</span>

<span class="c1"># Making wrappers</span>
<span class="n">wrapper_1</span> <span class="o">=</span> <span class="nb">method</span> <span class="ss">:a_method_look_like_function</span>
<span class="n">wrapper_2</span> <span class="o">=</span> <span class="nb">method</span> <span class="ss">:a_method_look_like_function</span>
<span class="nb">puts</span> <span class="n">wrapper_1</span> <span class="o">==</span> <span class="n">wrapper_2</span>                         <span class="c1"># =&gt; true</span>

<span class="c1"># Calling method stored in wrapper</span>
<span class="n">wrapper_1</span><span class="p">.</span><span class="nf">call</span> <span class="s2">"world, inside wrapper"</span>              <span class="c1"># =&gt; "Hello world, inside wrapper"</span>
<span class="n">wrapper_1</span> <span class="s2">"world, inside wrapper"</span>                   <span class="c1"># =&gt; NoMethodError: undefined method `wrapper_1' for main:Object</span>
</code></pre>
              </div>
            </li>
          </ul>
          <h2 id="cc-vn--khc-mc-hay-gp">Các vấn đề khúc mắc hay gặp</h2>
          <h3 id="khc-nhau-gia-lambda-v-proc">Khác nhau giữa <code class="highlighter-rouge">lambda</code> và <code class="highlighter-rouge">Proc</code></h3>
          <p><a href="/ruby/2013/10/21/ruby-lambda-and-proc/">Bài viết</a>:</p>
          <ul>
            <li>Bản chất của <code class="highlighter-rouge">lambda</code> gần như một method, mặc dù <code class="highlighter-rouge">lambda</code> không phải là
instance của class <code class="highlighter-rouge">Method</code>:
    
              <ul>
                <li><code class="highlighter-rouge">lambda</code> kiểm tra số lượng tham số truyền vào</li>
                <li><code class="highlighter-rouge">return</code> khỏi <code class="highlighter-rouge">lambda</code> giống hệt như <code class="highlighter-rouge">return</code> khỏi method</li>
              </ul>
            </li>
            <li><code class="highlighter-rouge">Proc</code> không phải là method mà là control flow:
    
              <ul>
                <li>Code block về bản chất là một <code class="highlighter-rouge">Proc</code></li>
                <li><code class="highlighter-rouge">Proc</code> không kiểm tra số lượng tham số truyền vào</li>
                <li><code class="highlighter-rouge">return</code> khỏi <code class="highlighter-rouge">Proc</code> là return khỏi <em>block chứa <code class="highlighter-rouge">Proc</code> đó</em></li>
              </ul>
            </li>
          </ul>
          <div class="language-ruby highlighter-rouge">
            <pre class="highlight"><code><span class="k">def</span> <span class="nf">using_lambda</span>
  <span class="n">my_lambda</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">'Return from a lambda'</span> <span class="p">}</span>
  <span class="n">my_lambda</span><span class="p">.</span><span class="nf">call</span>
  <span class="k">return</span> <span class="s1">'End of using_lambda reached'</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">using_proc</span>
  <span class="n">my_proc</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">'Return from a Proc'</span> <span class="p">}</span>
  <span class="n">my_proc</span><span class="p">.</span><span class="nf">call</span>
  <span class="k">return</span> <span class="s1">'End of using_proc reached'</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">using_lambda</span>       <span class="c1"># =&gt; 'End of using_lambda reached'</span>
<span class="nb">puts</span> <span class="n">using_proc</span>         <span class="c1"># =&gt; 'Return from a Proc'</span>
</code></pre>
          </div>
          <h2 id="cc-k-thut">Các kỹ thuật</h2>
          <h3 id="x-l-file-v-th-mc">Xử lý file và thư mục</h3>
          <ul>
            <li>
              <p>Lấy thư mục <code class="highlighter-rouge">$HOME</code>:</p>
              <div class="language-ruby highlighter-rouge">
                <pre class="highlight"><code><span class="no">Dir</span><span class="p">.</span><span class="nf">home</span>
<span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span> <span class="s2">"~"</span>
</code></pre>
              </div>
            </li>
            <li>
              <p>Tạo thư mục <code class="highlighter-rouge">$HOME/tmp/foo</code>, permission <code class="highlighter-rouge">700</code>:</p>
              <div class="language-ruby highlighter-rouge">
                <pre class="highlight"><code><span class="c1"># Ambiguous parameters, not recommended</span>
<span class="no">Dir</span><span class="p">.</span><span class="nf">mkdir</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"~/tmp/"</span><span class="p">)</span>
<span class="no">Dir</span><span class="p">.</span><span class="nf">mkdir</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"~/tmp/foo"</span><span class="p">),</span> <span class="mo">0700</span>

<span class="c1"># Recommended</span>
<span class="no">FileUtils</span><span class="p">.</span><span class="nf">mkdir_p</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"~/tmp/foo"</span><span class="p">),</span> <span class="ss">:mode</span> <span class="o">=&gt;</span> <span class="mo">0700</span>
</code></pre>
              </div>
            </li>
            <li>
              <p>Xóa cây thư mục:</p>
              <div class="language-ruby highlighter-rouge">
                <pre class="highlight"><code><span class="c1"># Beware of security vulnerability, safe bet: read doc, set :secure =&gt; true</span>
<span class="no">FileUtils</span><span class="p">.</span><span class="nf">rm_r</span>    <span class="s2">"~/tmp/foo"</span><span class="p">,</span> <span class="ss">:secure</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:force</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="no">FileUtils</span><span class="p">.</span><span class="nf">rmtree</span>  <span class="s2">"~/tmp/foo"</span><span class="p">,</span> <span class="ss">:secure</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre>
              </div>
            </li>
            <li>
              <p>Kiểm tra một file/thư mục có tồn tại hay không:</p>
              <div class="language-ruby highlighter-rouge">
                <pre class="highlight"><code><span class="c1"># All are the same</span>
<span class="no">File</span><span class="p">.</span><span class="nf">exists?</span>      <span class="n">a_path</span>
<span class="no">FileTest</span><span class="p">.</span><span class="nf">exists?</span>  <span class="n">a_path</span>
<span class="no">Pathname</span><span class="p">.</span><span class="nf">exists?</span>  <span class="n">a_path</span>
</code></pre>
              </div>
            </li>
            <li>
              <p>Glob:</p>
              <div class="language-ruby highlighter-rouge">
                <pre class="highlight"><code><span class="nb">puts</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="s2">"/*"</span><span class="p">)</span>
</code></pre>
              </div>
            </li>
          </ul>
          <h3 id="kim-tra-xem-mt-url-c-tn-ti-hay-khng">Kiểm tra xem một URL có tồn tại hay không</h3>
          <p>Sử dụng <code class="highlighter-rouge">net/http</code> để request header và kiểm code return code có phải là 2xx
hoặc 3xx hay không:</p>
          <div class="language-ruby highlighter-rouge">
            <pre class="highlight"><code><span class="k">def</span> <span class="nf">url_exists?</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">url</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">parse</span> <span class="n">url</span>
  <span class="n">return_code</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">url</span><span class="p">.</span><span class="nf">port</span><span class="p">).</span><span class="nf">request_head</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">path</span><span class="p">).</span><span class="nf">code</span>
  <span class="kp">nil</span> <span class="o">!=</span> <span class="p">((</span><span class="sr">/3../</span> <span class="o">=~</span> <span class="n">return_code</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="sr">/2../</span> <span class="o">=~</span> <span class="n">return_code</span><span class="p">))</span>
<span class="k">end</span>
</code></pre>
          </div>
          <h3 id="copy-file">Copy file</h3>
          <p>Sử dụng <code class="highlighter-rouge">FileUtils.cp(source, destination)</code>.</p>
          <h3 id="duyt-tt-c-cc-file-trong-th-mc">Duyệt tất cả các file trong thư mục</h3>
          <p>Sử dụng module <code class="highlighter-rouge">find</code> để nội dung thư mục recursively:</p>
          <div class="language-ruby highlighter-rouge">
            <pre class="highlight"><code><span class="nb">require</span> <span class="s1">'find'</span>

<span class="no">Find</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'/tmp/'</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">find</span>
<span class="p">}</span>
</code></pre>
          </div>
          <h3 id="prettifybeautify-html">Prettify/beautify HTML</h3>
          <p>Cách tốt nhất là sử dụng thư viện
            <a href="https://github.com/tobym/nokogiri-pretty">Nokogiri-pretty</a> trong
            <a href="http://nokogiri.org/">Nokogiri</a>.</p>
          <div class="language-ruby highlighter-rouge">
            <pre class="highlight"><code><span class="nb">require</span> <span class="s1">'nokogiri-pretty'</span>

<span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">XML</span><span class="p">(</span><span class="s1">'&lt;foo&gt;&lt;bar&gt;baz&lt;/bar&gt;&lt;bar&gt;buzz&lt;/bar&gt;&lt;/foo&gt;'</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">doc</span><span class="p">.</span><span class="nf">human</span>
</code></pre>
          </div>
          <h3 id="khi-no-dng--khi-no-dng-">Khi nào dùng <code class="highlighter-rouge">.</code>, khi nào dùng <code class="highlighter-rouge">::</code>?</h3>
          <p>Về bản chất, <code class="highlighter-rouge">.</code> là message operator và <code class="highlighter-rouge">::</code> là scope operator.  <code class="highlighter-rouge">::</code> cho phép
truy cập đến scope của một class hoặc object, trong khi <code class="highlighter-rouge">.</code> chỉ đơn thuần là
gọi method mà thôi.</p>
          <p>Ví dụ sau đây trích dẫn từ
            <a href="http://en.wikipedia.org/wiki/Scope_resolution_operator#Ruby">Wikipedia</a></p>
          <div class="language-ruby highlighter-rouge">
            <pre class="highlight"><code><span class="k">module</span> <span class="nn">Example</span>
  <span class="no">Version</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span>

  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span> <span class="c1"># We are accessing the Module's singleton class</span>
    <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">who</span> <span class="o">=</span> <span class="s2">"World"</span><span class="p">)</span>
       <span class="s2">"hello </span><span class="si">#{</span><span class="n">who</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Example</span><span class="o">::</span><span class="n">hello</span>          <span class="c1"># =&gt; "hello World"</span>
<span class="no">Example</span><span class="p">.</span><span class="nf">hello</span> <span class="s2">"hacker"</span>  <span class="c1"># =&gt; "hello hacker"</span>

<span class="no">Example</span><span class="o">::</span><span class="no">Version</span>        <span class="c1"># =&gt; 1.0</span>
<span class="no">Example</span><span class="o">.</span><span class="no">Version</span>         <span class="c1"># NoMethodError</span>

<span class="c1">#</span>
<span class="c1"># This illustrates the difference between the message (.) operator and the</span>
<span class="c1"># scope operator in Ruby (::) We can use both ::hello and .hello, because</span>
<span class="c1"># hello is a part of Example's scope and because Example responds to the</span>
<span class="c1"># message hello.</span>
<span class="c1">#</span>

<span class="c1"># We can't do the same with ::Version and .Version, because Version is within</span>
<span class="c1"># the scope of Example, but Example can't respond to the message Version,</span>
<span class="c1"># since there is no method to respond with.</span>
<span class="c1">#</span>
</code></pre>
          </div>
          <h3 id="khi-no-dng-singleton-khi-no-dng-module">Khi nào dùng <code class="highlighter-rouge">singleton</code>, khi nào dùng <code class="highlighter-rouge">module</code>?</h3>
          <p>Một trong những tình huống tốt sử dụng
            <a href="http://en.wikipedia.org/wiki/Singleton_pattern">Singleton</a> và module là khi
bạn muốn đóng gói state vào trong một thực thể duy nhất.  Điểm khác nhau duy
nhất giữa singleton và module trong trường hợp này là quá trình initialization:
* của singleton được trì hoãn cho đến khi bạn tạo instance
* của module diễn ra ngay khi module được khai báo</p>
          <h3 id="t-du-phn-cch-nghn-cho-s">Đặt dấu phân cách nghìn cho số</h3>
          <p>Lấy dấu <code class="highlighter-rouge">,</code> làm dấu ngân cách, chẳng hạn:</p>
          <div class="highlighter-rouge">
            <pre class="highlight"><code>1234      -&gt; 1,234
12345     -&gt; 12,365
12365678  -&gt; 12,365,678
</code></pre>
          </div>
          <p>Dấu phân cách cách có thể được đặt sử dụng regular expression như sau:</p>
          <div class="language-ruby highlighter-rouge">
            <pre class="highlight"><code><span class="n">formatted_number</span> <span class="o">=</span> <span class="n">number</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">reverse</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/...(?=.)/</span><span class="p">,</span> <span class="s1">'\&amp;,'</span><span class="p">).</span><span class="nf">reverse</span>
</code></pre>
          </div>
          <p>Thay dấu <code class="highlighter-rouge">,</code> tại tham số thứ hai của <code class="highlighter-rouge">gsub</code> để dùng ký tự khác làm dấu phân
cách.</p>
        </div>
        <hr class="fin" />
      </article>
      <footer>
        <div id="copyright-footer">© Ha-Duong Nguyen 2016.
    Unless clearly stated, all contents are released under the terms of
    the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC
    BY-SA v4.0 license</a>.</div>
      </footer>
      <div id="fine-print">
        <p>
        </p>
      </div>
    </section>
  </body>
</html>